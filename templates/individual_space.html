{% extends "base.html" %}

{% block title %}{{ space.name }} · BubblesBnB{% endblock %}

{% block content %}
  <!-- Flatpickr CSS (page-local) -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

  <div class="row g-4 align-items-start">
    <!-- Image -->
    <div class="col-12 col-lg-6">
      {# Use a mock image (1–4) based on id; drop mock-1..4.jpg in static/img/ #}
      {% set img_index = ((space.id - 1) % 4) + 1 %}
      <img
        class="img-fluid rounded shadow-sm w-100"
        style="max-height: 360px; object-fit: cover;"
        src="{{ url_for('static', filename='img/mock-' ~ img_index ~ '.jpg') }}"
        alt="{{ space.name }} photo">
    </div>

    <!-- Details + booking -->
    <div class="col-12 col-lg-6">
      <h1 class="h3 mb-1">{{ space.name }}</h1>

      <div class="d-flex align-items-center gap-2 mb-3">
        <span class="fs-5">£{{ '%.2f'|format(space.price_per_night) }}</span>
        <span class="text-muted">/ night</span>
        {% if space.booked_flag %}
          <span class="badge text-bg-secondary">Booked</span>
        {% else %}
          <span class="badge text-bg-success">Available</span>
        {% endif %}
      </div>

      <p class="mb-3">{{ space.description }}</p>

      <p class="small text-muted mb-4">
        Host: {{ user.name or user.username }}
      </p>

      <!-- Booking form -->
      <div class="card shadow-sm">
        <div class="card-body">
          <h2 class="h5 mb-3">Select an available date</h2>
          <form action="{{ url_for('make_booking', id=space.id) }}" method="post" class="row g-3">
            <div class="col-12 col-md-8">
              <input id="datepicker"
                     name="datepicker"
                     type="text"
                     class="form-control"
                     placeholder="Choose a date"
                     required>
            </div>
            <div class="col-12 col-md-4 d-grid">
              <button id="booking-btn" type="submit" class="btn btn-primary">Book this space</button>
            </div>
          </form>
          <div class="form-text mt-2">Only available dates can be selected.</div>
        </div>
      </div>

      <div class="mt-3">
        <a class="btn btn-outline-secondary" href="{{ url_for('get_spaces') }}">Back to all spaces</a>
      </div>
    </div>
  </div>

  <!-- Flatpickr JS (page-local) -->
  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script>
    const availableDates = {{ dates | tojson }};
    flatpickr("#datepicker", {
      dateFormat: "Y-m-d",
      enable: availableDates,     // only allow these dates
      minDate: "today",
      disableMobile: true,
      altInput: true,
      altFormat: "F j, Y",
      allowInput: true
    });
  </script>
{% endblock %}
